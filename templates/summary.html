<!DOCTYPE html>
<html>
{% if msg %}
  <div style="padding: 10px; background-color: #e0ffe0; border: 1px solid green; margin-bottom: 20px;">
    {{ msg }}
  </div>
{% endif %}

<head>
    <title>Portfolio Summary</title>
    <style>
  .collapsible {
    background-color: #f1f1f1;
    color: #444;
    cursor: pointer;
    padding: 12px;
    width: 100%;
    text-align: left;
    border: none;
    outline: none;
    font-size: 16px;
    font-weight: bold;
    margin-top: 10px;
  }

  .collapsible.active, .collapsible:hover {
    background-color: #ddd;
  }

  .content {
    padding: 0 18px;
    display: none;
    overflow: hidden;
    margin-bottom: 20px;
  }
</style>
</head>
<body>
    <!-- <div>
    {{ summary_text | safe }}
    </div> -->
  <div class="summary-tables">
  {% for asset in summary_data %}
    <div class="asset-group">
      <button class="collapsible">{{ asset.asset_type }} ‚Äî Total: {{ asset.total_row[3] }} (Invested)</button>
      <div class="content">
        <table border="1" cellpadding="5" cellspacing="0">
          <thead>
            <tr>
              {% for col in asset.headers %}
                <th>{{ col }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for row in asset.rows %}
              <tr>
                {% for cell in row %}
                  <td>{{ cell }}</td>
                {% endfor %}
              </tr>
            {% endfor %}
            <tr style="font-weight: bold;">
              {% for cell in asset.total_row %}
                <td>{{ cell }}</td>
              {% endfor %}
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  {% endfor %}
</div>

<div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
    <form action="{{ url_for('main.upload') }}" method="get">
        <button type="submit">‚¨ÜÔ∏è Upload New Transactions</button>
    </form>

    <p style="font-size: 14px; color: #888; margin: 0;">
        üì¶ Current Storage Backend: <strong>{{ backend_type }}</strong>
    </p>

    <form action="{{ url_for('settings.backend') }}" method="get">
        <button type="submit">‚öôÔ∏è Switch Backend</button>
    </form>
{% if session.get('user') %}
    <p>
        Logged in as <strong>{{ session.get('user') }}</strong>
        | <a href="{{ url_for('auth.logout') }}">Logout</a>
    </p>
{% else %}
     <p>
        <a href="{{ url_for('auth.login') }}">Login</a>
    </p>
{% endif %}

</div>

    <hr>

    <h3>üìÑ Existing Transactions</h3>
<table border="1" cellpadding="5" cellspacing="0">
    <thead>
        <tr>
            {% for col in transaction_header %}
                <th>{{ col }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for row in transaction_data %}
            <tr>
                {% for cell in row %}
                    <td>{{ cell }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination Controls -->
<div style="margin-top: 20px;">
    {% if page > 1 %}
        <a href="{{ url_for('main.summary', page=page-1) }}">‚¨ÖÔ∏è Previous</a>
    {% endif %}
    
    <span>Page {{ page }} of {{ total_pages }}</span>

    {% if page < total_pages %}
        <a href="{{ url_for('main.summary', page=page+1) }}">Next ‚û°Ô∏è</a>
    {% endif %}
</div>
  <script>
  document.addEventListener("DOMContentLoaded", function() {
    const collapsibles = document.querySelectorAll(".collapsible");
    collapsibles.forEach(button => {
      button.addEventListener("click", function() {
        this.classList.toggle("active");
        const content = this.nextElementSibling;
        if (content.style.display === "block") {
          content.style.display = "none";
        } else {
          content.style.display = "block";
        }
      });
    });
  });
</script>
</body>
</html>
